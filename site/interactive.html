<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Light Panel // Interactive</title>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-slider.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
      .top-buffer {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>


    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-slider.min.js"></script>
    <script src="js/jscolor.min.js"></script>
    
    <div class="container">
      <div class="list-group top-buffer" id="wave-config-list"></div>
   
      <div class="controls">
        <input id="brightness-slider" data-slider-id='brightness-slider' type="text" data-slider-min="0" data-slider-max="1" data-slider-value="[0.1, 0.7]" data-slider-step="0.01" />
      </div>
      <p></p> 
      
      <pre id="json"></pre>
  </div>

  <script>
    $(document).ready(function() {
      var brightness = $('#brightness-slider').slider()
        .on('slide', brightnessChange)
        .data('slider');

      function brightnessChange() {
        var minmax = brightness.getValue();
        var config_name = $('.wave-config-list-item.active').data('wave_config_name');
        var config_json = $('.wave-config-list-item.active').data('wave_config_json');
        config_json.waves[0].min = minmax[0];
        config_json.waves[0].max = minmax[1];
        $("#json").html(JSON.stringify(config_json, null, 2));
        $.ajax({
              type: "PUT",
              url: "/api/wave_config/"+config_name,
              contentType: "application/json",
              data: JSON.stringify(config_json)
        });
      }

      $.ajax({
              type: "GET",
              url: "/mode/interactive_wave"
      });
      
      $.getJSON("/api/wave_config", function(wave_config) {
          var items = [];
          $.each(wave_config, function(key, value) {
            item = $('<a href="#" class="list-group-item list-group-item-action wave-config-list-item">' + key + '</a>');
            item.data('wave_config_name', key);
            item.data('wave_config_json', value);
            items.push(item);
          });
          $("#wave-config-list").append(items);
      });

      $("#wave-config-list").on("click", ".wave-config-list-item", function() {
        var config_name = $(this).data('wave_config_name');
        var config_json = $(this).data('wave_config_json');
        $.ajax({
                type: "GET",
                url: "/mode/interactive_wave/"+config_name
        });

        $('.wave-config-list-item').removeClass('active');
        $(this).toggleClass('active');

        $("#json").html(JSON.stringify(config_json, null, 2));

        brightness.setValue([config_json.waves[0].min, config_json.waves[0].max], false, false);
      });
    });


    </script>

  </body>
</html>
